#!/usr/bin/env python
import ctypes

# REQUIRES the canon sdk extracted to this folder with the heirarchy intact
# starting with the Windows directory. See the type_file path for specifics.


# Av - Aperture Value
# Note: Values labeled "(1/3)" represent property values when the step set in
# the Custom
av = [ "1", "1.1", "1.2", "1.2 (1/3)", "1.4", "1.6", "1.8", "1.8 (1/3)", "2",
       "2.2", "2.5", "2.5 (1/3)", "2.8", "3.2", "3.5", "3.5 (1/3)", "4", 
       "4.5 (1/3)", "4.5", "5.0", "5.6", "6.3", "6.7", "7.1", "8", "9", "9.5",
       "10", "11", "13 (1/3)", "13", "14", "16", "18", "19", "20", "22", "25",
       "27", "29", "32", "36", "38", "40", "45", "51", "54", "57", "64", "72",
       "76", "80", "91" ]
av_v = [ 0x08, 0x0B, 0x0C, 0x0D, 0x10, 0x13, 0x14, 0x15, 0x18, 0x1B, 0x1C, 0x1D,
         0x20, 0x23, 0x24, 0x25, 0x28, 0x2B, 0x2C, 0x2D, 0x30, 0x33, 0x34, 0x35,
         0x38, 0x3B, 0x3C, 0x3D, 0x40, 0x43, 0x44, 0x45, 0x48, 0x4B, 0x4C, 0x4D,
         0x50, 0x53, 0x54, 0x55, 0x58, 0x5B, 0x5C, 0x5D, 0x60, 0x63, 0x64, 0x65,
         0x68, 0x6B, 0x6C, 0x6D, 0x70 ]
aperture_values = {   "1":0x08,       "3.2":0x23,      "9.5":0x3C, "29":0x55,
                    "1.1":0x0B,       "3.5":0x24,       "10":0x3D, "32":0x58,
                    "1.2":0x0C, "3.5 (1/3)":0x25,       "11":0x40, "36":0x5B,
              "1.2 (1/3)":0x0D,         "4":0x28, "13 (1/3)":0x43, "38":0x5C,
                    "1.4":0x10, "4.5 (1/3)":0x2B,       "13":0x44, "40":0x5D,
                    "1.6":0x13,       "4.5":0x2C,       "14":0x45, "45":0x60,
                    "1.8":0x14,       "5.0":0x2D,       "16":0x48, "51":0x63,
              "1.8 (1/3)":0x15,       "5.6":0x30,       "18":0x4B, "54":0x64,
                      "2":0x18,       "6.3":0x33,       "19":0x4C, "57":0x65,
                    "2.2":0x1B,       "6.7":0x34,       "20":0x4D, "64":0x68,
                    "2.5":0x1C,       "7.1":0x35,       "22":0x50, "72":0x6B,
              "2.5 (1/3)":0x1D,         "8":0x38,       "25":0x53, "76":0x6C,
                    "2.8":0x20,         "9":0x3B,       "27":0x54, "80":0x6D,
                                                                   "91":0x70 }
# ISO speed
iso = [ "Auto", "50", "100", "125", "160", "200", "250", "320", "400", "500",
        "640", "800", "1000", "1250", "1600", "2000", "2500", "3200", "4000",
        "5000", "6400", "8000", "10000", "12800", "25600", "51200", "102400",
        "204800", "409600" ]
iso_v = [ 0x00000000, 0x00000040, 0x00000048, 0x0000004b, 0x0000004d,
          0x00000050, 0x00000053, 0x00000055, 0x00000058, 0x0000005b,
          0x0000005d, 0x00000060, 0x00000063, 0x00000065, 0x00000068,
          0x0000006b, 0x0000006d, 0x00000070, 0x00000073, 0x00000075,
          0x00000078, 0x0000007b, 0x0000007d, 0x00000080, 0x00000088,
          0x00000090, 0x00000098, 0x000000a0, 0x000000a8 ]
iso_speed = { "Auto":0x00000000,  "640":0x0000005d,   "6400":0x00000078,
                "50":0x00000040,  "800":0x00000060,   "8000":0x0000007b,
               "100":0x00000048, "1000":0x00000063,  "10000":0x0000007d,
               "125":0x0000004b, "1250":0x00000065,  "12800":0x00000080,
               "160":0x0000004d, "1600":0x00000068,  "25600":0x00000088,
               "200":0x00000050, "2000":0x0000006b,  "51200":0x00000090,
               "250":0x00000053, "2500":0x0000006d, "102400":0x00000098,
               "320":0x00000055, "3200":0x00000070, "204800":0x000000a0,
               "400":0x00000058, "4000":0x00000073, "409600":0x000000a8,
               "500":0x0000005b, "5000":0x00000075 }

# Tv - Shutter Speed
tv = [ "Bulb", "30", "25", "20", "20 (1/3)", "15", "13", "10", "10 (1/3)",
       "8", "6 (1/3)", "6", "5", "4", "3.2", "3", "2.5", "2", "1.6", "1.5",
       "1.3", "1", "0.8", "0.7", "0.6", "0.5", "0.4", "0.3", "0.3 (1/3)",
       "1/4", "1/5", "1/6", "1/6 (1/3)", "1/8", "1/10 (1/3)", "1/10", "1/13",
       "1/15", "1/20 (1/3)", "1/20", "1/25", "1/30", "1/40", "1/45", "1/50",
       "1/60", "1/80", "1/90", "1/100", "1/125", "1/160", "1/180", "1/200",
       "1/250", "1/320", "1/350", "1/400", "1/500", "1/640", "1/750", "1/800",
       "1/1000", "1/1250", "1/1500", "1/1600", "1/2000", "1/2500", "1/3000",
       "1/3200", "1/4000", "1/5000", "1/6000", "1/6400", "1/8000" ]
tv_v = [ 0x0C, 0x10, 0x13, 0x14, 0x15, 0x18, 0x1B, 0x1C, 0x1D, 0x20, 0x23, 0x24,
         0x25, 0x28, 0x2B, 0x2C, 0x2D, 0x30, 0x33, 0x34, 0x35, 0x38, 0x3B, 0x3C,
         0x3D, 0x40, 0x43, 0x44, 0x45, 0x48, 0x4B, 0x4C, 0x4D, 0x50, 0x53, 0x54,
         0x55, 0x58, 0x5B, 0x5C, 0x5D, 0x60, 0x63, 0x64, 0x65, 0x68, 0x6B, 0x6C,
         0x6D, 0x70, 0x73, 0x74, 0x75, 0x78, 0x7B, 0x7C, 0x7D, 0x80, 0x83, 0x84,
         0x85, 0x88, 0x8B, 0x8C, 0x8D, 0x90, 0x93, 0x94, 0x95, 0x98, 0x9B, 0x9C,
         0x9D, 0xA0 ]
shutter_speed = {
              "Bulb":0x0C,        "1.5":0x34, "1/20 (1/3)":0x5B,  "1/500":0x80,
                "30":0x10,        "1.3":0x35,       "1/20":0x5C,  "1/640":0x83,
                "25":0x13,          "1":0x38,       "1/25":0x5D,  "1/750":0x84,
                "20":0x14,        "0.8":0x3B,       "1/30":0x60,  "1/800":0x85,
          "20 (1/3)":0x15,        "0.7":0x3C,       "1/40":0x63, "1/1000":0x88,
                "15":0x18,        "0.6":0x3D,       "1/45":0x64, "1/1250":0x8B,
                "13":0x1B,        "0.5":0x40,       "1/50":0x65, "1/1500":0x8C,
                "10":0x1C,        "0.4":0x43,       "1/60":0x68, "1/1600":0x8D,
          "10 (1/3)":0x1D,        "0.3":0x44,       "1/80":0x6B, "1/2000":0x90,
                 "8":0x20,  "0.3 (1/3)":0x45,       "1/90":0x6C, "1/2500":0x93,
           "6 (1/3)":0x23,        "1/4":0x48,      "1/100":0x6D, "1/3000":0x94,
                 "6":0x24,        "1/5":0x4B,      "1/125":0x70, "1/3200":0x95,
                 "5":0x25,        "1/6":0x4C,      "1/160":0x73, "1/4000":0x98,
                 "4":0x28,  "1/6 (1/3)":0x4D,      "1/180":0x74, "1/5000":0x9B,
               "3.2":0x2B,        "1/8":0x50,      "1/200":0x75, "1/6000":0x9C,
                 "3":0x2C, "1/10 (1/3)":0x53,      "1/250":0x78, "1/6400":0x9D,
               "2.5":0x2D,       "1/10":0x54,      "1/320":0x7B, "1/8000":0xA0,
                 "2":0x30,       "1/13":0x55,      "1/350":0x7C,
               "1.6":0x33,       "1/15":0x58,      "1/400":0x7D }
#
class EdsDirectoryItemInfo(ctypes.Structure):
    _fields_ = [ ("size", ctypes.c_ulonglong),
                 ("isFolder", ctypes.c_int),
                 ("groupID", ctypes.c_ulong),
                 ("option", ctypes.c_ulong),
                 ("szFileName", ctypes.c_char * 256),
                 ("format", ctypes.c_ulong),
                 ("dateTime", ctypes.c_ulong) ]

#
eds_typ = {} # this will be dictionary of edsdk types

# Load Errors from EDSDKTypes.h
type_file = open("Windows/EDSDK/Header/EDSDKTypes.h", "rb")

header = 132 # ignore the first header lines
footer = 1357

line_num = 0 # The current line number as we walk through the file
for line in type_file:
    if line_num <= header or line_num >= footer: line_num += 1; continue

    t0 = line.split("0x")
    t1 = line.split('=')
    t2 = t0[0].split("#define ")

    check1 = len(t1) > 1
    check2 = len(t2) > 1
    check3 = len(t0) > 1

    if check1:
        t3 = line.replace(' ','').split('=')
        t4 = t3[0].replace('\t','')
        t5 = t3[1].replace(',','').replace('\t','')
        t5 = t5.split("/*")[0].replace("\r\n",'')

        try:
            if t5[:2] == "0x": t5 = int(t5,16)
            else: t5 = int(t5)

            eds_typ[t4] = t5
        except:
            continue

    elif check2:
        t3 = t2[-1].replace(' ','').replace('\t','')
        if t3[:3] == "EDS" or t3[:4] == "kEds":
            t4 = int("0x" + t0[-1].replace("\r\n",''),16)
            eds_typ[t3] = t4

    line_num += 1

type_file.close()

if __name__ == "__main__":
    # Print a list of the errors in numerical order
    for s in sorted( ((v,k) for v,k in eds_typ.iteritems())): print s
